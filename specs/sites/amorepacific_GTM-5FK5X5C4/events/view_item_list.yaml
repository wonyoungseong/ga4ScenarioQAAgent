# view_item_list 이벤트 스펙
# GA4 E-Commerce 이벤트: 상품 리스트 조회

event: view_item_list
ga4_event_name: view_item_list
dataLayer_event: ap_search
trigger_timing: "상품 리스트가 노출 되었을 시 (상품 카테고리 페이지 / 검색 결과)"
required: true

description: |
  사용자가 상품 리스트 페이지를 조회할 때 발생하는 이벤트입니다.
  검색 결과 페이지 또는 상품 카테고리 페이지에서 발생합니다.
  검색 관련 정보와 노출된 상품 목록 정보가 포함됩니다.

parameters:
  # 검색어
  - ga4_param: search_term
    dev_guide_var: AP_SEARCH_TERM
    gtm_variable: "{{JS - Search Term}}"
    data_type: string
    description: "검색에 사용한 키워드"
    example: "헤라 선크림"
    required: true

  # 검색 유형
  - ga4_param: search_type
    dev_guide_var: AP_SEARCH_TYPE
    gtm_variable: "{{JS - Search Type}}"
    data_type: string
    description: "검색 유형 (해쉬태그, 직접검색 등)"
    example: "인기검색어"
    required: true

  # 검색 결과 상품 개수
  - ga4_param: search_resultcount
    dev_guide_var: AP_SEARCH_ITEMS_NUM
    gtm_variable: "{{JS - Search Result Count}}"
    data_type: number
    description: "검색결과 페이지에 노출된 제품 개수 (상품 정보만 집계)"
    example: 12
    required: true

  # 검색 결과 전체 개수
  - ga4_param: search_total_count
    dev_guide_var: AP_SEARCH_NUM
    gtm_variable: "{{JS - Search Total Count}}"
    data_type: number
    description: "검색결과 페이지에 노출된 전체(제품 + 콘텐츠) 개수"
    example: 10
    required: true

  # 검색 성공 여부
  - ga4_param: search_result
    dev_guide_var: AP_SEARCH_RESULT
    gtm_variable: "{{JS - Search Result}}"
    data_type: string
    description: "정상적으로 검색이 되었는지 (노출된 상품 여부)"
    example: "Y"
    required: true
    validation: |
      Y: 상품이 1개 이상 노출됨
      N: 상품이 0개 (콘텐츠만 있어도 N)

  # 통화 정보
  - ga4_param: currency
    dev_guide_var: AP_ECOMM_CURRENCY
    gtm_variable: "{{JS - Currency}}"
    data_type: string
    description: "통화 코드 (ISO 3자리)"
    example: "KRW"
    required: true

  # 상품 배열 (items)
  - ga4_param: items
    dev_guide_var: AP_SEARCH_PRDRESULT
    gtm_variable: "{{JS - View Item List DataLayer}}"
    data_type: array
    description: "노출된 상위 10개 상품 배열 (dataLayer variable에서 확인)"
    required: true
    note: "노출된 상위 10개 상품에 대하여 선언"

  # 개별 상품 파라미터 (items 배열 내)
  - ga4_param: item_id
    dev_guide_var: code
    gtm_variable: "(items 배열 내)"
    data_type: string
    description: "상품 ID (SKU)"
    example: "111070000513"
    required: true

  - ga4_param: item_name
    dev_guide_var: name
    gtm_variable: "(items 배열 내)"
    data_type: string
    description: "상품 이름"
    example: "블랙 쿠션 SPF34/PA++ (본품 15g+리필 15g)"
    required: true

  - ga4_param: item_brand
    dev_guide_var: brand
    gtm_variable: "(items 배열 내)"
    data_type: string
    description: "상품 브랜드"
    example: "헤라"
    required: true

  - ga4_param: item_category
    dev_guide_var: cate
    gtm_variable: "(items 배열 내)"
    data_type: string
    description: "상품 카테고리 (depth는 '/'로 구분)"
    example: "메이크업/페이스/쿠션"
    required: true

  - ga4_param: index
    dev_guide_var: index
    gtm_variable: "(items 배열 내)"
    data_type: number
    description: "item_list 영역 내에서 상품이 노출된 위치"
    example: 1
    required: true

  - ga4_param: item_list_name
    dev_guide_var: item_list_name
    gtm_variable: "(items 배열 내)"
    data_type: string
    description: "상품이 노출된 영역 (대문자)"
    example: "SEARCH"
    required: true
    validation: "SEARCH / PRODUCT_LIST / MAIN 등"

  - ga4_param: apg_brand_code
    dev_guide_var: apg_brand_code
    gtm_variable: "(items 배열 내)"
    data_type: string
    description: "아모레퍼시픽 그룹 브랜드 코드"
    example: "11107"
    required: true

  - ga4_param: price
    dev_guide_var: price
    gtm_variable: "(items 배열 내)"
    data_type: number
    description: "할인이 적용된 최종 가격 (Unit Price)"
    example: 49400
    required: true

  - ga4_param: discount
    dev_guide_var: discount
    gtm_variable: "(items 배열 내)"
    data_type: number
    description: "상품 할인 금액"
    example: 10000
    required: true

  - ga4_param: prdprice
    dev_guide_var: prdprice
    gtm_variable: "(items 배열 내)"
    data_type: number
    description: "할인이 반영되지 않은 상품 금액"
    example: 59400
    required: true

dataLayer_example: |
  var AP_SEARCH_TERM = '헤라 선크림';
  var AP_SEARCH_TYPE = '인기검색어';
  var AP_SEARCH_ITEMS_NUM = '12';
  var AP_SEARCH_NUM = '10';
  var AP_SEARCH_RESULT = 'Y';

  var AP_ECOMM_CURRENCY = 'KRW';

  // 노출된 상위 10개 상품에 대하여 선언
  var AP_SEARCH_PRDRESULT = [{
    "code": "111070000513",
    "name": "블랙 쿠션 SPF34/PA++ (본품 15g+리필 15g)",
    "brand": "헤라",
    "index": "1",
    "item_list_name": "SEARCH",
    "cate": "메이크업/페이스/쿠션",
    "apg_brand_code": "11107",
    "price": 49400,
    "discount": 10000,
    "prdprice": 59400
  }, {
    // ... 추가 상품
  }];

  window.dataLayer.push({'event':'ap_search'})

verification_notes:
  - "검색과 관련된 변수가 모두 선언된 이후에 dataLayer.push 함수가 실행되어야 함"
  - "제품정보(code, name, brand, cate, apg_brand_code)는 모든 전자상거래 단계에서 항상 동일해야 함"
  - "노출된 상위 10개 상품에 대하여 선언"
  - "AP_SEARCH_RESULT는 상품 노출 여부만 판단 (콘텐츠만 있으면 N)"
  - "GTM parser를 통해 실제 파라미터 매핑 확인 필요"
