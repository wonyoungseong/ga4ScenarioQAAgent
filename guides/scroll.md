# scroll 이벤트 가이드

## 이벤트 정의
**사용자가 페이지를 스크롤할 때** 발생하는 이벤트입니다.
특정 스크롤 깊이(%)에 도달하면 이벤트가 발생합니다.

## GTM 트리거 조건 (실제 구현)

### 트리거 타입
- **SCROLL_DEPTH** (스크롤 깊이)

### 트리거 설명
- 페이지 스크롤 시 특정 깊이(25%, 50%, 75%, 90% 등)에서 발생
- 각 임계값을 처음 통과할 때만 발생 (중복 발생 안 함)

## 이벤트 발생 조건

### 발생 시점
1. 스크롤하여 설정된 깊이에 도달
2. 일반적으로 25%, 50%, 75%, 90% 지점에서 발생

### 측정 페이지
- MAIN (메인 페이지)
- PRODUCT_DETAIL (상품 상세 페이지)
- EVENT_DETAIL (이벤트 상세 페이지)

### dataLayer 구조
```javascript
dataLayer.push({
  event: "scroll",
  scroll_depth: 50, // 스크롤 깊이 %
  duration_array: [10, 5, 3, 2, 1, ...] // 각 구간별 체류 시간
});
```

## 시각적 판단 기준

### 이벤트가 발생해야 하는 상황 (Should Fire)

1. **페이지 스크롤 시**
   - 사용자가 아래로 스크롤하여 콘텐츠 탐색
   - 25%, 50%, 75%, 90% 깊이 도달 시

2. **긴 콘텐츠 페이지**
   - 상품 상세 페이지 (상세 설명, 리뷰 등)
   - 이벤트 상세 페이지
   - 메인 페이지 (여러 섹션)

### 이벤트가 발생하면 안 되는 상황 (Should NOT Fire)

1. **스크롤 없는 페이지**
   - 전체 콘텐츠가 한 화면에 보이는 경우

2. **스크롤하지 않음**
   - 사용자가 스크롤하지 않고 페이지 이탈

## 시각적 특징 (Visual Cues)

- 스크롤 가능한 긴 페이지
- 스크롤바가 있는 페이지
- 여러 섹션으로 구성된 콘텐츠

## 혼동하기 쉬운 이벤트

| 이벤트 | 발생 조건 | 차이점 |
|-------|----------|--------|
| `scroll` | 스크롤 깊이 도달 | 스크롤 행동 측정 |
| `view_item` | 상품 페이지 로드 | 페이지 진입만으로 발생 |

## 주의사항

1. **깊이 기준**: 픽셀이 아닌 % 기준
2. **중복 방지**: 같은 깊이는 한 번만 발생
3. **페이지 한정**: 특정 페이지 타입에서만 측정 (MAIN, PRODUCT_DETAIL, EVENT_DETAIL)

---

## 5. 수집 파라미터

> **중요**: 아래 파라미터는 대표 예시입니다.
> 실제 구현은 사이트별 GTM 설정에 따라 다르므로, **시나리오 설계 시 반드시 GTM 파싱을 통해 실제 파라미터를 확인**해야 합니다.
> GTM 파싱 방법: [docs/gtm-parsing-guide.md](../docs/gtm-parsing-guide.md) 참조

### 이벤트 레벨 파라미터

| 파라미터 | 설명 | 예시 | 필수 |
|---------|------|------|-----|
| scroll_depth | 스크롤 깊이 (%) | 25, 50, 75, 90 | O |
| duration_array | 각 구간별 체류 시간 배열 | [10, 5, 3, 2, 1] | △ |

### GTM 내장 스크롤 변수

| 변수명 | 설명 | 예시 |
|--------|------|------|
| Scroll Depth Threshold | 현재 스크롤 깊이 (%) | 50 |
| Scroll Depth Units | 측정 단위 | "percent" 또는 "pixels" |
| Scroll Direction | 스크롤 방향 | "vertical" 또는 "horizontal" |

### 사이트별 추가 파라미터 (Amoremall 기준)

| 파라미터 | 설명 | 예시 |
|---------|------|------|
| page_type | 페이지 타입 | "MAIN", "PRODUCT_DETAIL", "EVENT_DETAIL" |
| page_path | 현재 페이지 경로 | "/product/12345" |
| content_length | 콘텐츠 전체 길이 (px) | 5000 |

---

## 6. 관련 이벤트

| 이벤트 | 발생 시점 | 구분 |
|-------|----------|------|
| `scroll` | 스크롤 깊이 도달 | 스크롤 행동 |
| `page_view` | 페이지 로드 | 페이지 진입 |
| `view_item` | 상품 상세 진입 | 페이지 로드 시 |

---

## 7. 시나리오 예시

### Should Fire (스크롤 시)
```
- 페이지 스크롤하여 25% 깊이 도달
- 페이지 스크롤하여 50% 깊이 도달
- 페이지 스크롤하여 75% 깊이 도달
- 페이지 스크롤하여 90% 깊이 도달
- 상품 상세 페이지에서 리뷰 섹션까지 스크롤
```

### Should NOT Fire
```
- 스크롤하지 않고 페이지 이탈
- 전체 콘텐츠가 화면에 보이는 짧은 페이지
- 이미 도달한 깊이 재통과 (중복 방지)
- 측정 대상이 아닌 페이지 (예: 로그인 페이지)
```

### 구현 필요 (Gap)
```
- 스크롤했으나 이벤트 미발생
- 설정된 임계값에서 미발생
- duration_array 수집 누락
```

---

## 8. 시나리오 작성 지침

### 트리거 타입: SCROLL_DEPTH (GTM 내장 트리거)

이 이벤트는 **GTM의 Scroll Depth 트리거**로 발생합니다.
사용자가 특정 스크롤 깊이에 도달하면 GTM이 자동으로 이벤트를 발생시킵니다.

### 시나리오에 포함할 내용
```
O 포함해야 함:
- 예상 dataLayer 구조 (dataLayer.push 코드)
- event 이름 (scroll)
- scroll_depth 파라미터 (스크롤 깊이 %)
- 측정 대상 페이지 타입

X 포함하지 않음:
- GTM LINK_CLICK/CLICK 트리거 관련 내용
- 클릭 기반 DOM 속성 추출
```

### 예상 dataLayer 구조 (시나리오에 포함)
```javascript
dataLayer.push({
  event: "scroll",
  scroll_depth: 50, // 스크롤 깊이 %
  duration_array: [10, 5, 3, 2, 1] // 각 구간별 체류 시간
});
```

### 검증 포인트
```
1. GTM 트리거 확인:
   - Scroll Depth 트리거 설정 확인
   - 임계값 (25%, 50%, 75%, 90%) 확인

2. 발생 시점 확인:
   - 스크롤하여 설정 깊이 도달 시 발생
   - 각 임계값은 한 번만 발생 (중복 방지)
   - 지정된 페이지 타입에서만 발생
```

---

## 9. 환경별 검증

> **공통 가이드 참조**: [docs/environment-validation-guide.md](../docs/environment-validation-guide.md)
>
> PC/Mobile, 로그인/비로그인 환경별 검증은 공통 가이드를 참조하세요.

### scroll 특화 환경 검증

| 환경 | 특이사항 |
|-----|---------|
| Mobile | 터치 스크롤, 관성 스크롤에서 정확한 깊이 측정 |
| PC | 마우스 휠, 스크롤바 드래그, 키보드 스크롤 모두 측정 |
| 긴 페이지 | 무한 스크롤 페이지에서 깊이 계산 방식 확인 |
